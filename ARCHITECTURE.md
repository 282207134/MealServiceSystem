# ç³»ç»Ÿæ¶æ„è®¾è®¡æ–‡æ¡£

## ğŸ“ æ¶æ„æ¦‚è§ˆ

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜æ ¡å›­ç‚¹é¤ç³»ç»Ÿçš„æŠ€æœ¯æ¶æ„ã€è®¾è®¡æ¨¡å¼å’Œæœ€ä½³å®è·µã€‚

## ğŸ›ï¸ æ•´ä½“æ¶æ„

### ä¸‰å±‚æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å±•ç¤ºå±‚ (Presentation)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   é¡¾å®¢ç•Œé¢    â”‚  â”‚   å•†å®¶ç•Œé¢    â”‚  â”‚   å…±äº«ç»„ä»¶    â”‚  â”‚
â”‚  â”‚   Screens    â”‚  â”‚   Screens    â”‚  â”‚   Widgets    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â†“                  â†“                  â†“          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚          çŠ¶æ€ç®¡ç†å±‚ (Providers/BLoC)            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“ â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 ä¸šåŠ¡é€»è¾‘å±‚ (Domain Layer)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   ç”¨ä¾‹ç±»      â”‚  â”‚  ä¸šåŠ¡å®ä½“     â”‚  â”‚  ä»“åº“æ¥å£     â”‚  â”‚
â”‚  â”‚  UseCases    â”‚  â”‚  Entities    â”‚  â”‚ Repositories â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“ â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  æ•°æ®å±‚ (Data Layer)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ä»“åº“å®ç°ç±»    â”‚  â”‚   æ•°æ®æ¨¡å‹    â”‚  â”‚   æ•°æ®æº      â”‚  â”‚
â”‚  â”‚ Repos Impl   â”‚  â”‚   Models     â”‚  â”‚ DataSources  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“ â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   åç«¯æœåŠ¡ (Supabase)                    â”‚
â”‚    æ•°æ®åº“  |  è®¤è¯  |  å­˜å‚¨  |  å®æ—¶é€šä¿¡  |  API        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“‚ è¯¦ç»†ç›®å½•ç»“æ„

```
food_ordering_app/
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ core/                          # æ ¸å¿ƒåŠŸèƒ½æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ config/                    # é…ç½®æ–‡ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ supabase_config.dart   # Supabase é…ç½®ï¼ˆä¸æäº¤åˆ° Gitï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ app_config.dart        # åº”ç”¨é…ç½®
â”‚   â”‚   â”œâ”€â”€ constants/                 # å¸¸é‡å®šä¹‰
â”‚   â”‚   â”‚   â”œâ”€â”€ app_colors.dart        # é¢œè‰²å¸¸é‡
â”‚   â”‚   â”‚   â”œâ”€â”€ app_strings.dart       # å­—ç¬¦ä¸²å¸¸é‡
â”‚   â”‚   â”‚   â”œâ”€â”€ app_dimensions.dart    # å°ºå¯¸å¸¸é‡
â”‚   â”‚   â”‚   â””â”€â”€ order_status.dart      # è®¢å•çŠ¶æ€æšä¸¾
â”‚   â”‚   â”œâ”€â”€ theme/                     # ä¸»é¢˜é…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ app_theme.dart         # åº”ç”¨ä¸»é¢˜
â”‚   â”‚   â”‚   â””â”€â”€ text_styles.dart       # æ–‡å­—æ ·å¼
â”‚   â”‚   â”œâ”€â”€ utils/                     # å·¥å…·ç±»
â”‚   â”‚   â”‚   â”œâ”€â”€ validators.dart        # è¡¨å•éªŒè¯å·¥å…·
â”‚   â”‚   â”‚   â”œâ”€â”€ formatters.dart        # æ ¼å¼åŒ–å·¥å…·ï¼ˆæ—¥æœŸã€è´§å¸ç­‰ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ logger.dart            # æ—¥å¿—å·¥å…·
â”‚   â”‚   â”‚   â””â”€â”€ extensions.dart        # Dart æ‰©å±•æ–¹æ³•
â”‚   â”‚   â””â”€â”€ error/                     # é”™è¯¯å¤„ç†
â”‚   â”‚       â”œâ”€â”€ exceptions.dart        # å¼‚å¸¸å®šä¹‰
â”‚   â”‚       â””â”€â”€ failures.dart          # å¤±è´¥ç±»å‹å®šä¹‰
â”‚   â”‚
â”‚   â”œâ”€â”€ domain/                        # ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆé¢†åŸŸå±‚ï¼‰
â”‚   â”‚   â”œâ”€â”€ entities/                  # ä¸šåŠ¡å®ä½“
â”‚   â”‚   â”‚   â”œâ”€â”€ user.dart              # ç”¨æˆ·å®ä½“
â”‚   â”‚   â”‚   â”œâ”€â”€ merchant.dart          # å•†å®¶å®ä½“
â”‚   â”‚   â”‚   â”œâ”€â”€ product.dart           # å•†å“å®ä½“
â”‚   â”‚   â”‚   â”œâ”€â”€ category.dart          # åˆ†ç±»å®ä½“
â”‚   â”‚   â”‚   â”œâ”€â”€ order.dart             # è®¢å•å®ä½“
â”‚   â”‚   â”‚   â””â”€â”€ order_item.dart        # è®¢å•é¡¹å®ä½“
â”‚   â”‚   â”œâ”€â”€ repositories/              # ä»“åº“æ¥å£ï¼ˆæŠ½è±¡ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ auth_repository.dart   # è®¤è¯ä»“åº“æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ merchant_repository.dart  # å•†å®¶ä»“åº“æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ product_repository.dart   # å•†å“ä»“åº“æ¥å£
â”‚   â”‚   â”‚   â””â”€â”€ order_repository.dart     # è®¢å•ä»“åº“æ¥å£
â”‚   â”‚   â””â”€â”€ usecases/                  # ç”¨ä¾‹ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰
â”‚   â”‚       â”œâ”€â”€ auth/                  # è®¤è¯ç›¸å…³ç”¨ä¾‹
â”‚   â”‚       â”‚   â”œâ”€â”€ sign_in_usecase.dart
â”‚   â”‚       â”‚   â”œâ”€â”€ sign_up_usecase.dart
â”‚   â”‚       â”‚   â””â”€â”€ sign_out_usecase.dart
â”‚   â”‚       â”œâ”€â”€ product/               # å•†å“ç›¸å…³ç”¨ä¾‹
â”‚   â”‚       â”‚   â”œâ”€â”€ get_products_usecase.dart
â”‚   â”‚       â”‚   â”œâ”€â”€ create_product_usecase.dart
â”‚   â”‚       â”‚   â””â”€â”€ update_product_usecase.dart
â”‚   â”‚       â””â”€â”€ order/                 # è®¢å•ç›¸å…³ç”¨ä¾‹
â”‚   â”‚           â”œâ”€â”€ create_order_usecase.dart
â”‚   â”‚           â”œâ”€â”€ get_orders_usecase.dart
â”‚   â”‚           â””â”€â”€ update_order_status_usecase.dart
â”‚   â”‚
â”‚   â”œâ”€â”€ data/                          # æ•°æ®å±‚
â”‚   â”‚   â”œâ”€â”€ models/                    # æ•°æ®æ¨¡å‹ï¼ˆDTOï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ user_model.dart        # ç”¨æˆ·æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ merchant_model.dart    # å•†å®¶æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ product_model.dart     # å•†å“æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ category_model.dart    # åˆ†ç±»æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ order_model.dart       # è®¢å•æ¨¡å‹
â”‚   â”‚   â”‚   â””â”€â”€ order_item_model.dart  # è®¢å•é¡¹æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ repositories/              # ä»“åº“å®ç°
â”‚   â”‚   â”‚   â”œâ”€â”€ auth_repository_impl.dart
â”‚   â”‚   â”‚   â”œâ”€â”€ merchant_repository_impl.dart
â”‚   â”‚   â”‚   â”œâ”€â”€ product_repository_impl.dart
â”‚   â”‚   â”‚   â””â”€â”€ order_repository_impl.dart
â”‚   â”‚   â””â”€â”€ datasources/               # æ•°æ®æº
â”‚   â”‚       â”œâ”€â”€ remote/                # è¿œç¨‹æ•°æ®æº
â”‚   â”‚       â”‚   â”œâ”€â”€ supabase_auth_datasource.dart
â”‚   â”‚       â”‚   â”œâ”€â”€ supabase_merchant_datasource.dart
â”‚   â”‚       â”‚   â”œâ”€â”€ supabase_product_datasource.dart
â”‚   â”‚       â”‚   â””â”€â”€ supabase_order_datasource.dart
â”‚   â”‚       â””â”€â”€ local/                 # æœ¬åœ°æ•°æ®æºï¼ˆç¼“å­˜ï¼‰
â”‚   â”‚           â””â”€â”€ local_cache.dart
â”‚   â”‚
â”‚   â”œâ”€â”€ presentation/                  # å±•ç¤ºå±‚
â”‚   â”‚   â”œâ”€â”€ providers/                 # çŠ¶æ€ç®¡ç†ï¼ˆRiverpodï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ auth_provider.dart     # è®¤è¯çŠ¶æ€
â”‚   â”‚   â”‚   â”œâ”€â”€ user_provider.dart     # ç”¨æˆ·ä¿¡æ¯çŠ¶æ€
â”‚   â”‚   â”‚   â”œâ”€â”€ merchant_provider.dart # å•†å®¶çŠ¶æ€
â”‚   â”‚   â”‚   â”œâ”€â”€ products_provider.dart # å•†å“åˆ—è¡¨çŠ¶æ€
â”‚   â”‚   â”‚   â”œâ”€â”€ cart_provider.dart     # è´­ç‰©è½¦çŠ¶æ€
â”‚   â”‚   â”‚   â””â”€â”€ orders_provider.dart   # è®¢å•çŠ¶æ€
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ screens/                   # é¡µé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ splash/                # å¯åŠ¨é¡µ
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ splash_screen.dart
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/                  # è®¤è¯ç›¸å…³é¡µé¢
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ login_screen.dart
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ register_screen.dart
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ widgets/           # è®¤è¯é¡µé¢ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ customer/              # é¡¾å®¢ç«¯é¡µé¢
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ home/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ home_screen.dart
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ widgets/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ menu/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ menu_screen.dart
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ product_detail_screen.dart
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ widgets/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ cart/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ cart_screen.dart
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ widgets/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ orders/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ orders_screen.dart
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ order_detail_screen.dart
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ widgets/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ profile/
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ profile_screen.dart
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ widgets/
â”‚   â”‚   â”‚   â””â”€â”€ merchant/              # å•†å®¶ç«¯é¡µé¢
â”‚   â”‚   â”‚       â”œâ”€â”€ dashboard/
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ dashboard_screen.dart
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ widgets/
â”‚   â”‚   â”‚       â”œâ”€â”€ menu_management/
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ menu_management_screen.dart
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ add_product_screen.dart
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ edit_product_screen.dart
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ widgets/
â”‚   â”‚   â”‚       â”œâ”€â”€ order_management/
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ order_management_screen.dart
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ order_detail_screen.dart
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ widgets/
â”‚   â”‚   â”‚       â””â”€â”€ settings/
â”‚   â”‚   â”‚           â”œâ”€â”€ settings_screen.dart
â”‚   â”‚   â”‚           â””â”€â”€ widgets/
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ widgets/                   # å…±äº«ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ common/                # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ custom_button.dart
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ custom_text_field.dart
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ loading_indicator.dart
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ error_widget.dart
â”‚   â”‚   â”‚   â”œâ”€â”€ product/               # å•†å“ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ product_card.dart
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ product_grid.dart
â”‚   â”‚   â”‚   â””â”€â”€ order/                 # è®¢å•ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”‚       â”œâ”€â”€ order_card.dart
â”‚   â”‚   â”‚       â””â”€â”€ order_status_badge.dart
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ router/                    # è·¯ç”±é…ç½®
â”‚   â”‚       â””â”€â”€ app_router.dart        # åº”ç”¨è·¯ç”±
â”‚   â”‚
â”‚   â””â”€â”€ main.dart                      # åº”ç”¨å…¥å£
â”‚
â”œâ”€â”€ test/                              # æµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ unit/                          # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ widget/                        # ç»„ä»¶æµ‹è¯•
â”‚   â””â”€â”€ integration/                   # é›†æˆæµ‹è¯•
â”‚
â”œâ”€â”€ assets/                            # èµ„æºæ–‡ä»¶
â”‚   â”œâ”€â”€ images/                        # å›¾ç‰‡
â”‚   â”œâ”€â”€ icons/                         # å›¾æ ‡
â”‚   â””â”€â”€ fonts/                         # å­—ä½“
â”‚
â”œâ”€â”€ pubspec.yaml                       # é¡¹ç›®ä¾èµ–é…ç½®
â”œâ”€â”€ analysis_options.yaml              # ä»£ç åˆ†æé…ç½®
â””â”€â”€ README.md                          # é¡¹ç›®è¯´æ˜æ–‡æ¡£
```

## ğŸ”„ æ•°æ®æµå‘

### 1. é¡¾å®¢ä¸‹å•æµç¨‹

```
ç”¨æˆ·ç‚¹å‡»ä¸‹å•æŒ‰é’®
    â†“
[UI Layer] CartScreen
    â†“
è°ƒç”¨ Provider
    â†“
[Provider] CartProvider.checkout()
    â†“
è°ƒç”¨ UseCase
    â†“
[UseCase] CreateOrderUseCase.call()
    â†“
è°ƒç”¨ Repository æ¥å£
    â†“
[Repository] OrderRepository.createOrder()
    â†“
è°ƒç”¨ DataSource
    â†“
[DataSource] SupabaseOrderDataSource.createOrder()
    â†“
å‘é€è¯·æ±‚åˆ° Supabase
    â†“
æ•°æ®åº“å†™å…¥æˆåŠŸ
    â†“
è¿”å›è®¢å•æ•°æ®
    â†“
æ›´æ–° UI çŠ¶æ€
    â†“
æ˜¾ç¤ºè®¢å•ç¡®è®¤é¡µé¢
```

### 2. å•†å®¶æ¥æ”¶è®¢å•æµç¨‹

```
Supabase è§¦å‘ Realtime äº‹ä»¶
    â†“
[DataSource] æ¥æ”¶æ–°è®¢å•äº‹ä»¶
    â†“
[Repository] å¤„ç†è®¢å•æ•°æ®
    â†“
[Provider] OrdersProvider æ›´æ–°çŠ¶æ€
    â†“
[UI] è‡ªåŠ¨åˆ·æ–°è®¢å•åˆ—è¡¨
    â†“
æ˜¾ç¤ºæ–°è®¢å•æé†’
```

## ğŸ¯ è®¾è®¡æ¨¡å¼

### 1. Repository æ¨¡å¼

**ç›®çš„ï¼š** å°†æ•°æ®è®¿é—®é€»è¾‘ä¸ä¸šåŠ¡é€»è¾‘åˆ†ç¦»

```dart
// æ¥å£å®šä¹‰ï¼ˆdomainå±‚ï¼‰
abstract class ProductRepository {
  Future<List<Product>> getProducts(String merchantId);
  Future<Product> createProduct(Product product);
  Future<void> updateProduct(Product product);
  Future<void> deleteProduct(String productId);
}

// å®ç°ç±»ï¼ˆdataå±‚ï¼‰
class ProductRepositoryImpl implements ProductRepository {
  final SupabaseProductDataSource _dataSource;
  
  ProductRepositoryImpl(this._dataSource);
  
  @override
  Future<List<Product>> getProducts(String merchantId) async {
    // ä»æ•°æ®æºè·å–æ•°æ®
    final models = await _dataSource.getProducts(merchantId);
    // è½¬æ¢ä¸ºé¢†åŸŸå®ä½“
    return models.map((m) => m.toEntity()).toList();
  }
  
  // ... å…¶ä»–æ–¹æ³•å®ç°
}
```

### 2. Provider æ¨¡å¼ï¼ˆçŠ¶æ€ç®¡ç†ï¼‰

**ç›®çš„ï¼š** ç®¡ç†åº”ç”¨çŠ¶æ€ï¼Œå®ç°å“åº”å¼UIæ›´æ–°

```dart
// ä½¿ç”¨ Riverpod è¿›è¡ŒçŠ¶æ€ç®¡ç†

// 1. æä¾›ä¾èµ–æ³¨å…¥
final productRepositoryProvider = Provider<ProductRepository>((ref) {
  final dataSource = SupabaseProductDataSource(supabase);
  return ProductRepositoryImpl(dataSource);
});

// 2. åˆ›å»ºçŠ¶æ€Provider
final productsProvider = StateNotifierProvider<ProductsNotifier, AsyncValue<List<Product>>>((ref) {
  final repository = ref.watch(productRepositoryProvider);
  return ProductsNotifier(repository);
});

// 3. çŠ¶æ€ç®¡ç†ç±»
class ProductsNotifier extends StateNotifier<AsyncValue<List<Product>>> {
  final ProductRepository _repository;
  
  ProductsNotifier(this._repository) : super(const AsyncValue.loading()) {
    loadProducts();
  }
  
  Future<void> loadProducts() async {
    state = const AsyncValue.loading();
    try {
      final products = await _repository.getProducts();
      state = AsyncValue.data(products);
    } catch (e, stack) {
      state = AsyncValue.error(e, stack);
    }
  }
}

// 4. åœ¨UIä¸­ä½¿ç”¨
class ProductsScreen extends ConsumerWidget {
  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final productsState = ref.watch(productsProvider);
    
    return productsState.when(
      data: (products) => ProductsList(products: products),
      loading: () => LoadingIndicator(),
      error: (error, stack) => ErrorWidget(error: error),
    );
  }
}
```

### 3. UseCase æ¨¡å¼

**ç›®çš„ï¼š** å°è£…å•ä¸€ä¸šåŠ¡é€»è¾‘ï¼Œæé«˜ä»£ç å¯æµ‹è¯•æ€§

```dart
// UseCase åŸºç±»
abstract class UseCase<Type, Params> {
  Future<Type> call(Params params);
}

// å…·ä½“ UseCase å®ç°
class CreateOrderUseCase extends UseCase<Order, CreateOrderParams> {
  final OrderRepository _orderRepository;
  final ProductRepository _productRepository;
  
  CreateOrderUseCase(this._orderRepository, this._productRepository);
  
  @override
  Future<Order> call(CreateOrderParams params) async {
    // 1. éªŒè¯å•†å“å¯ç”¨æ€§
    for (var item in params.items) {
      final product = await _productRepository.getProduct(item.productId);
      if (!product.isAvailable) {
        throw ProductNotAvailableException(product.name);
      }
    }
    
    // 2. è®¡ç®—æ€»é‡‘é¢
    final totalAmount = params.items.fold<double>(
      0, 
      (sum, item) => sum + (item.quantity * item.unitPrice),
    );
    
    // 3. åˆ›å»ºè®¢å•
    return await _orderRepository.createOrder(
      userId: params.userId,
      merchantId: params.merchantId,
      items: params.items,
      totalAmount: totalAmount,
      note: params.note,
    );
  }
}

// å‚æ•°ç±»
class CreateOrderParams {
  final String userId;
  final String merchantId;
  final List<OrderItem> items;
  final String? note;
  
  CreateOrderParams({
    required this.userId,
    required this.merchantId,
    required this.items,
    this.note,
  });
}
```

### 4. Factory æ¨¡å¼

**ç›®çš„ï¼š** ç»Ÿä¸€åˆ›å»ºå¯¹è±¡çš„æ–¹å¼

```dart
// æ¨¡å‹å·¥å‚
class ProductModel {
  final String id;
  final String name;
  final double price;
  
  ProductModel({
    required this.id,
    required this.name,
    required this.price,
  });
  
  // ä» JSON åˆ›å»º
  factory ProductModel.fromJson(Map<String, dynamic> json) {
    return ProductModel(
      id: json['id'] as String,
      name: json['name'] as String,
      price: (json['price'] as num).toDouble(),
    );
  }
  
  // ä»å®ä½“åˆ›å»º
  factory ProductModel.fromEntity(Product entity) {
    return ProductModel(
      id: entity.id,
      name: entity.name,
      price: entity.price,
    );
  }
  
  // è½¬æ¢ä¸ºå®ä½“
  Product toEntity() {
    return Product(
      id: id,
      name: name,
      price: price,
    );
  }
  
  // è½¬æ¢ä¸º JSON
  Map<String, dynamic> toJson() {
    return {
      'id': id,
      'name': name,
      'price': price,
    };
  }
}
```

## ğŸ” å®‰å…¨æ€§è®¾è®¡

### 1. Row Level Security (RLS)

åœ¨ Supabase ä¸­é…ç½® RLS ç­–ç•¥ï¼Œç¡®ä¿æ•°æ®å®‰å…¨ï¼š

```sql
-- ç”¨æˆ·åªèƒ½æŸ¥çœ‹è‡ªå·±çš„è®¢å•
CREATE POLICY "ç”¨æˆ·æŸ¥çœ‹è‡ªå·±çš„è®¢å•"
  ON orders FOR SELECT
  USING (auth.uid() = user_id);

-- å•†å®¶åªèƒ½ä¿®æ”¹è‡ªå·±çš„è®¢å•çŠ¶æ€
CREATE POLICY "å•†å®¶ä¿®æ”¹è‡ªå·±çš„è®¢å•"
  ON orders FOR UPDATE
  USING (
    merchant_id IN (
      SELECT id FROM merchants WHERE user_id = auth.uid()
    )
  );
```

### 2. è®¤è¯ä»¤ç‰Œç®¡ç†

```dart
// è‡ªåŠ¨åˆ·æ–° Token
class AuthService {
  final SupabaseClient _supabase;
  
  AuthService(this._supabase) {
    // ç›‘å¬è®¤è¯çŠ¶æ€å˜åŒ–
    _supabase.auth.onAuthStateChange.listen((data) {
      final event = data.event;
      if (event == AuthChangeEvent.tokenRefreshed) {
        // Token å·²åˆ·æ–°ï¼Œæ›´æ–°æœ¬åœ°å­˜å‚¨
        _updateLocalToken(data.session?.accessToken);
      } else if (event == AuthChangeEvent.signedOut) {
        // ç”¨æˆ·ç™»å‡ºï¼Œæ¸…ç†æœ¬åœ°æ•°æ®
        _clearLocalData();
      }
    });
  }
  
  // æ›´æ–°æœ¬åœ° Token
  void _updateLocalToken(String? token) {
    // å®ç° Token å­˜å‚¨é€»è¾‘
  }
  
  // æ¸…ç†æœ¬åœ°æ•°æ®
  void _clearLocalData() {
    // å®ç°æ•°æ®æ¸…ç†é€»è¾‘
  }
}
```

### 3. è¾“å…¥éªŒè¯

```dart
// è¡¨å•éªŒè¯å™¨
class Validators {
  // é‚®ç®±éªŒè¯
  static String? validateEmail(String? value) {
    if (value == null || value.isEmpty) {
      return 'è¯·è¾“å…¥é‚®ç®±åœ°å€';
    }
    
    final emailRegex = RegExp(
      r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$',
    );
    
    if (!emailRegex.hasMatch(value)) {
      return 'è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€';
    }
    
    return null;
  }
  
  // å¯†ç éªŒè¯
  static String? validatePassword(String? value) {
    if (value == null || value.isEmpty) {
      return 'è¯·è¾“å…¥å¯†ç ';
    }
    
    if (value.length < 6) {
      return 'å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä½';
    }
    
    return null;
  }
  
  // ä»·æ ¼éªŒè¯
  static String? validatePrice(String? value) {
    if (value == null || value.isEmpty) {
      return 'è¯·è¾“å…¥ä»·æ ¼';
    }
    
    final price = double.tryParse(value);
    if (price == null || price < 0) {
      return 'è¯·è¾“å…¥æœ‰æ•ˆçš„ä»·æ ¼';
    }
    
    return null;
  }
}
```

## âš¡ æ€§èƒ½ä¼˜åŒ–

### 1. å›¾ç‰‡ç¼“å­˜

```dart
// ä½¿ç”¨ CachedNetworkImage ç¼“å­˜ç½‘ç»œå›¾ç‰‡
CachedNetworkImage(
  imageUrl: product.imageUrl,
  // å†…å­˜ç¼“å­˜é™åˆ¶
  memCacheWidth: 800,
  memCacheHeight: 800,
  // å ä½ç¬¦
  placeholder: (context, url) => const ShimmerLoading(),
  // é”™è¯¯å¤„ç†
  errorWidget: (context, url, error) => const Icon(Icons.error),
  // æ·¡å…¥åŠ¨ç”»
  fadeInDuration: const Duration(milliseconds: 300),
)
```

### 2. åˆ—è¡¨ä¼˜åŒ–

```dart
// ä½¿ç”¨ ListView.builder è¿›è¡Œæ‡’åŠ è½½
ListView.builder(
  // ä»…æ„å»ºå¯è§é¡¹
  itemCount: products.length,
  // æ·»åŠ ç¼“å­˜èŒƒå›´
  cacheExtent: 500.0,
  itemBuilder: (context, index) {
    final product = products[index];
    return ProductCard(product: product);
  },
)

// å®ç°åˆ†é¡µåŠ è½½
class ProductsList extends ConsumerStatefulWidget {
  @override
  ConsumerState<ProductsList> createState() => _ProductsListState();
}

class _ProductsListState extends ConsumerState<ProductsList> {
  final _scrollController = ScrollController();
  
  @override
  void initState() {
    super.initState();
    _scrollController.addListener(_onScroll);
  }
  
  void _onScroll() {
    // æ»šåŠ¨åˆ°åº•éƒ¨æ—¶åŠ è½½æ›´å¤š
    if (_scrollController.position.pixels >= 
        _scrollController.position.maxScrollExtent * 0.9) {
      ref.read(productsProvider.notifier).loadMore();
    }
  }
  
  @override
  Widget build(BuildContext context) {
    return ListView.builder(
      controller: _scrollController,
      itemCount: products.length,
      itemBuilder: (context, index) => ProductCard(product: products[index]),
    );
  }
}
```

### 3. çŠ¶æ€ç®¡ç†ä¼˜åŒ–

```dart
// ä½¿ç”¨ select ä»…ç›‘å¬éœ€è¦çš„çŠ¶æ€
Consumer(
  builder: (context, ref, child) {
    // ä»…åœ¨å•†å“åˆ—è¡¨å˜åŒ–æ—¶é‡å»ºï¼Œå¿½ç•¥å…¶ä»–çŠ¶æ€å˜åŒ–
    final products = ref.watch(
      productsProvider.select((state) => state.products),
    );
    
    return ProductsList(products: products);
  },
)

// ä½¿ç”¨ family å’Œ autoDispose é¿å…å†…å­˜æ³„æ¼
final productProvider = FutureProvider.autoDispose.family<Product, String>(
  (ref, productId) async {
    final repository = ref.watch(productRepositoryProvider);
    return repository.getProduct(productId);
  },
);
```

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### 1. å•å…ƒæµ‹è¯•

```dart
// æµ‹è¯• Repository
void main() {
  group('ProductRepository', () {
    late ProductRepository repository;
    late MockProductDataSource mockDataSource;
    
    setUp(() {
      mockDataSource = MockProductDataSource();
      repository = ProductRepositoryImpl(mockDataSource);
    });
    
    test('è·å–å•†å“åˆ—è¡¨æˆåŠŸ', () async {
      // Arrangeï¼ˆå‡†å¤‡ï¼‰
      final mockProducts = [
        ProductModel(id: '1', name: 'æµ‹è¯•å•†å“', price: 10.0),
      ];
      when(() => mockDataSource.getProducts(any()))
          .thenAnswer((_) async => mockProducts);
      
      // Actï¼ˆæ‰§è¡Œï¼‰
      final result = await repository.getProducts('merchant-1');
      
      // Assertï¼ˆæ–­è¨€ï¼‰
      expect(result, isA<List<Product>>());
      expect(result.length, 1);
      verify(() => mockDataSource.getProducts('merchant-1')).called(1);
    });
  });
}
```

### 2. Widget æµ‹è¯•

```dart
// æµ‹è¯• UI ç»„ä»¶
void main() {
  testWidgets('ProductCard æ˜¾ç¤ºå•†å“ä¿¡æ¯', (tester) async {
    // å‡†å¤‡æµ‹è¯•æ•°æ®
    final product = Product(
      id: '1',
      name: 'æµ‹è¯•å•†å“',
      price: 10.0,
      imageUrl: 'https://example.com/image.jpg',
    );
    
    // æ„å»º Widget
    await tester.pumpWidget(
      MaterialApp(
        home: Scaffold(
          body: ProductCard(product: product),
        ),
      ),
    );
    
    // éªŒè¯æ˜¾ç¤º
    expect(find.text('æµ‹è¯•å•†å“'), findsOneWidget);
    expect(find.text('Â¥10.00'), findsOneWidget);
  });
}
```

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### æ—¥å¿—ç³»ç»Ÿ

```dart
// ç»Ÿä¸€çš„æ—¥å¿—å·¥å…·
class AppLogger {
  static void debug(String message, [dynamic error, StackTrace? stackTrace]) {
    if (kDebugMode) {
      log('ğŸ› DEBUG: $message', error: error, stackTrace: stackTrace);
    }
  }
  
  static void info(String message) {
    log('â„¹ï¸ INFO: $message');
  }
  
  static void warning(String message, [dynamic error]) {
    log('âš ï¸ WARNING: $message', error: error);
  }
  
  static void error(String message, dynamic error, [StackTrace? stackTrace]) {
    log('âŒ ERROR: $message', error: error, stackTrace: stackTrace);
    // å¯ä»¥åœ¨è¿™é‡Œé›†æˆé”™è¯¯è¿½è¸ªæœåŠ¡ï¼ˆå¦‚ Sentryï¼‰
  }
}
```

## ğŸ”„ æŒç»­é›†æˆ/æŒç»­éƒ¨ç½² (CI/CD)

å»ºè®®ä½¿ç”¨ GitHub Actions æˆ– GitLab CI è¿›è¡Œè‡ªåŠ¨åŒ–æ„å»ºå’Œæµ‹è¯•ã€‚

```yaml
# .github/workflows/flutter.yml ç¤ºä¾‹
name: Flutter CI

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.16.0'
      - run: flutter pub get
      - run: flutter analyze
      - run: flutter test
      
  build-android:
    needs: test
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: subosito/flutter-action@v2
      - run: flutter build apk --release
```

## ğŸ“ ä»£ç è§„èŒƒ

### å‘½åçº¦å®š

- **ç±»åï¼š** PascalCaseï¼ˆå¦‚ï¼š`ProductRepository`ï¼‰
- **æ–¹æ³•åï¼š** camelCaseï¼ˆå¦‚ï¼š`getProducts`ï¼‰
- **å¸¸é‡ï¼š** lowerCamelCaseï¼ˆå¦‚ï¼š`primaryColor`ï¼‰
- **ç§æœ‰æˆå‘˜ï¼š** å‰ç¼€ä¸‹åˆ’çº¿ï¼ˆå¦‚ï¼š`_supabase`ï¼‰

### æ–‡ä»¶ç»„ç»‡

- æ¯ä¸ªæ–‡ä»¶åªåŒ…å«ä¸€ä¸ªä¸»è¦çš„ç±»æˆ–ç»„ä»¶
- ç›¸å…³çš„ç±»å¯ä»¥æ”¾åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­ï¼ˆå¦‚ï¼šModel å’Œ Entityï¼‰
- ä½¿ç”¨ barrel files (index.dart) ç®€åŒ–å¯¼å…¥

### æ³¨é‡Šè§„èŒƒ

```dart
/// å•†å“ä»“åº“æ¥å£
/// 
/// æä¾›å•†å“çš„å¢åˆ æ”¹æŸ¥åŠŸèƒ½
abstract class ProductRepository {
  /// è·å–æŒ‡å®šå•†å®¶çš„æ‰€æœ‰å•†å“
  /// 
  /// [merchantId] å•†å®¶ID
  /// è¿”å›å•†å“åˆ—è¡¨
  Future<List<Product>> getProducts(String merchantId);
  
  /// åˆ›å»ºæ–°å•†å“
  /// 
  /// [product] å•†å“ä¿¡æ¯
  /// è¿”å›åˆ›å»ºæˆåŠŸçš„å•†å“
  /// æŠ›å‡º [ProductException] å¦‚æœåˆ›å»ºå¤±è´¥
  Future<Product> createProduct(Product product);
}
```

## ğŸš€ éƒ¨ç½²æ¸…å•

å‘å¸ƒå‰æ£€æŸ¥æ¸…å•ï¼š

- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] ä»£ç å·²æ ¼å¼åŒ–ï¼ˆ`flutter format .`ï¼‰
- [ ] ä»£ç åˆ†ææ— è­¦å‘Šï¼ˆ`flutter analyze`ï¼‰
- [ ] å·²ç§»é™¤ debug æ—¥å¿—
- [ ] å·²æ›´æ–°ç‰ˆæœ¬å·
- [ ] å·²ç­¾å APK/IPA
- [ ] å·²æµ‹è¯•ä¸»è¦åŠŸèƒ½æµç¨‹
- [ ] å·²å‡†å¤‡åº”ç”¨å•†åº—æˆªå›¾å’Œæè¿°

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** 1.0.0  
**æœ€åæ›´æ–°ï¼š** 2024-11
