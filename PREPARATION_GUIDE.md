# ğŸš€ é¡¹ç›®å‡†å¤‡å®Œæ•´æŒ‡å—

æœ¬æ–‡æ¡£æä¾›è¯¦ç»†çš„æ­¥éª¤è¯´æ˜ï¼Œå¸®åŠ©æ‚¨å®Œæˆé¡¹ç›®çš„æ‰€æœ‰å‡†å¤‡å·¥ä½œã€‚

---

## ğŸ“‹ å½“å‰çŠ¶æ€æ£€æŸ¥æ¸…å•

### âœ… å·²å®Œæˆçš„å·¥ä½œ

- [x] **æ•°æ®åº“è¿ç§»**
  - 6ä¸ªè¡¨å·²åˆ›å»ºï¼ˆusers, merchants, categories, products, orders, order_itemsï¼‰
  - æ‰€æœ‰ç´¢å¼•å·²åˆ›å»º
  - è§¦å‘å™¨å‡½æ•°å·²åˆ›å»º
  - RLS ç­–ç•¥å·²é…ç½®

- [x] **å­˜å‚¨æ¡¶é…ç½®**
  - `product-images` å­˜å‚¨æ¡¶å·²åˆ›å»º
  - å­˜å‚¨ç­–ç•¥å·²é…ç½®ï¼ˆè¯»å–ã€ä¸Šä¼ ã€åˆ é™¤ï¼‰

- [x] **åº”ç”¨é…ç½®**
  - `supabase_config.dart` å·²åˆ›å»ºå¹¶é…ç½®
  - `app_bootstrap.dart` å·²æ›´æ–°
  - é…ç½®æ–‡ä»¶å·²åœ¨ `.gitignore` ä¸­

### âš ï¸ éœ€è¦æ‰‹åŠ¨é…ç½®çš„å†…å®¹

- [ ] **è®¤è¯è®¾ç½®**ï¼ˆåœ¨ Supabase Dashboard ä¸­é…ç½®ï¼‰
- [ ] **æµ‹è¯•æ•°æ®**ï¼ˆå¯é€‰ï¼Œç”¨äºå¼€å‘æµ‹è¯•ï¼‰

---

## ğŸ”§ è¯¦ç»†é…ç½®æ­¥éª¤

### æ­¥éª¤ 1ï¼šé…ç½®è®¤è¯ï¼ˆAuthenticationï¼‰

è¿™æ˜¯**å”¯ä¸€éœ€è¦**åœ¨ Supabase Dashboard ä¸­æ‰‹åŠ¨é…ç½®çš„éƒ¨åˆ†ã€‚

#### 1.1 å¯ç”¨é‚®ç®±è®¤è¯

1. **æ‰“å¼€ Supabase Dashboard**
   - è®¿é—®ï¼šhttps://supabase.com/dashboard
   - é€‰æ‹©æ‚¨çš„é¡¹ç›®ï¼š`fpxdfnevjeyzxuzhfumb`

2. **è¿›å…¥è®¤è¯è®¾ç½®**
   - å·¦ä¾§èœå• â†’ **Authentication** â†’ **Providers**

3. **å¯ç”¨ Email Provider**
   - æ‰¾åˆ° **Email** provider
   - ç‚¹å‡»å¼€å…³ï¼Œå¯ç”¨å®ƒ
   - é»˜è®¤é…ç½®å³å¯ï¼ˆå¼€å‘é˜¶æ®µï¼‰

#### 1.2 é…ç½®è®¤è¯è®¾ç½®

1. **è¿›å…¥ Settings**
   - **Authentication** â†’ **Settings**

2. **æ¨èé…ç½®**ï¼ˆå¼€å‘é˜¶æ®µï¼‰ï¼š
   ```
   âœ… Enable email confirmations: å¼€å¯ï¼ˆæ‚¨å·²å¯ç”¨ï¼Œç”¨æˆ·éœ€è¦éªŒè¯é‚®ç®±ï¼‰
   âœ… Enable password requirements: å¼€å¯
   æœ€å°å¯†ç é•¿åº¦ï¼š6
   â¬œ Disable signup: å…³é—­ï¼ˆå…è®¸æ³¨å†Œï¼‰
   ```
   
   **æ³¨æ„**ï¼šå¦‚æœå¯ç”¨äº†é‚®ç®±éªŒè¯ï¼Œç”¨æˆ·æ³¨å†Œåä¼šæ”¶åˆ°éªŒè¯é‚®ä»¶ï¼Œéœ€è¦ç‚¹å‡»é‚®ä»¶ä¸­çš„é“¾æ¥æ‰èƒ½ç™»å½•ã€‚

3. **é…ç½® URL**
   - **Authentication** â†’ **URL Configuration**
   - **Site URL**: `http://localhost`ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
   - **Redirect URLs**: æ·»åŠ  `http://localhost/**`ï¼ˆå¦‚æœéœ€è¦ï¼‰

#### 1.3 é…ç½®é‚®ä»¶æ¨¡æ¿ï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦é‚®ç®±éªŒè¯åŠŸèƒ½ï¼š

1. **Authentication** â†’ **Email Templates**
2. å¯ä»¥è‡ªå®šä¹‰ä»¥ä¸‹æ¨¡æ¿ï¼š
   - Confirm signupï¼ˆæ³¨å†Œç¡®è®¤ï¼‰
   - Reset passwordï¼ˆé‡ç½®å¯†ç ï¼‰
   - Magic Linkï¼ˆé­”æ³•é“¾æ¥ï¼‰

**æ³¨æ„**ï¼šå¼€å‘é˜¶æ®µå¯ä»¥å…³é—­é‚®ç®±éªŒè¯ï¼Œç›´æ¥ä½¿ç”¨é‚®ç®±å¯†ç ç™»å½•ã€‚

---

### æ­¥éª¤ 2ï¼šéªŒè¯é…ç½®

#### 2.1 éªŒè¯æ•°æ®åº“

åœ¨ Supabase Dashboard çš„ **SQL Editor** ä¸­æ‰§è¡Œï¼š

```sql
-- æ£€æŸ¥æ‰€æœ‰è¡¨
SELECT table_name 
FROM information_schema.tables 
WHERE table_schema = 'public' 
  AND table_type = 'BASE TABLE'
ORDER BY table_name;

-- åº”è¯¥çœ‹åˆ°ï¼šcategories, merchants, order_items, orders, products, users
```

#### 2.2 éªŒè¯å­˜å‚¨æ¡¶

åœ¨ Supabase Dashboard ä¸­ï¼š

1. **Storage** â†’ åº”è¯¥çœ‹åˆ° `product-images` å­˜å‚¨æ¡¶
2. ç‚¹å‡»å­˜å‚¨æ¡¶ â†’ **Policies** â†’ åº”è¯¥çœ‹åˆ° 3 ä¸ªç­–ç•¥ï¼š
   - æ‰€æœ‰äººå¯ä»¥è¯»å–å›¾ç‰‡
   - è®¤è¯ç”¨æˆ·å¯ä»¥ä¸Šä¼ å›¾ç‰‡
   - æ‰€æœ‰è€…å¯ä»¥åˆ é™¤å›¾ç‰‡

#### 2.3 éªŒè¯åº”ç”¨é…ç½®

æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä¸”é…ç½®æ­£ç¡®ï¼š

```bash
# æ£€æŸ¥é…ç½®æ–‡ä»¶
cat lib/core/config/supabase_config.dart

# åº”è¯¥çœ‹åˆ°æ‚¨çš„ Supabase URL å’Œ anon key
```

---

### æ­¥éª¤ 3ï¼šå®‰è£…ä¾èµ–å¹¶è¿è¡Œåº”ç”¨

#### 3.1 å®‰è£… Flutter ä¾èµ–

```bash
cd /Users/liuyu/MealServiceSystem
flutter pub get
```

#### 3.2 æ£€æŸ¥ä¾èµ–å®‰è£…

```bash
flutter doctor
```

ç¡®ä¿ Flutter ç¯å¢ƒæ­£å¸¸ã€‚

#### 3.3 è¿è¡Œåº”ç”¨

```bash
# åœ¨æ¨¡æ‹Ÿå™¨æˆ–çœŸæœºä¸Šè¿è¡Œ
flutter run

# æˆ–è€…æŒ‡å®šè®¾å¤‡
flutter devices  # æŸ¥çœ‹å¯ç”¨è®¾å¤‡
flutter run -d <device-id>
```

#### 3.4 éªŒè¯ Supabase è¿æ¥

åº”ç”¨å¯åŠ¨åï¼ŒæŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—ï¼š

- âœ… åº”è¯¥çœ‹åˆ°ï¼š`Supabase åˆå§‹åŒ–å®Œæˆ`
- âŒ å¦‚æœçœ‹åˆ°é”™è¯¯ï¼Œæ£€æŸ¥ï¼š
  - `supabase_config.dart` ä¸­çš„ URL å’Œ key æ˜¯å¦æ­£ç¡®
  - ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
  - Supabase é¡¹ç›®æ˜¯å¦æ­£å¸¸è¿è¡Œ

---

### æ­¥éª¤ 4ï¼šå‡†å¤‡æµ‹è¯•æ•°æ®ï¼ˆå¯é€‰ï¼‰

#### 4.1 åˆ›å»ºæµ‹è¯•ç”¨æˆ·

**æ–¹æ³• 1ï¼šé€šè¿‡ Supabase Dashboard**

1. **Authentication** â†’ **Users** â†’ **Add user**
2. æ‰‹åŠ¨åˆ›å»ºç”¨æˆ·ï¼š
   - Email: `merchant@test.com`
   - Password: `test123456`
   - æˆ–è€…ä½¿ç”¨ **Add user** â†’ **Generate password**

**æ–¹æ³• 2ï¼šé€šè¿‡ SQLï¼ˆéœ€è¦å…ˆé€šè¿‡ Dashboard åˆ›å»º Auth ç”¨æˆ·ï¼‰**

åœ¨ **SQL Editor** ä¸­æ‰§è¡Œï¼š

```sql
-- æ³¨æ„ï¼šéœ€è¦å…ˆåœ¨ Supabase Auth ä¸­åˆ›å»ºç”¨æˆ·
-- ç„¶åè·å–ç”¨æˆ·çš„ UUIDï¼Œæ’å…¥åˆ° users è¡¨

-- ç¤ºä¾‹ï¼šå‡è®¾å·²åˆ›å»ºäº† Auth ç”¨æˆ·ï¼ŒUUID ä¸º '550e8400-e29b-41d4-a716-446655440001'
INSERT INTO users (id, email, role, full_name, phone) 
VALUES (
  '550e8400-e29b-41d4-a716-446655440001',  -- ä½¿ç”¨ Auth ç”¨æˆ·çš„ UUID
  'merchant@test.com',
  'merchant',
  'æµ‹è¯•å•†å®¶',
  '13800138001'
)
ON CONFLICT (id) DO NOTHING;
```

#### 4.2 æ’å…¥æµ‹è¯•å•†å®¶æ•°æ®

```sql
-- æ’å…¥æµ‹è¯•å•†å®¶ï¼ˆéœ€è¦å…ˆæœ‰å¯¹åº”çš„ users è®°å½•ï¼‰
INSERT INTO merchants (user_id, name, description, is_active) 
VALUES (
  '550e8400-e29b-41d4-a716-446655440001',  -- ä½¿ç”¨ä¸Šé¢åˆ›å»ºçš„ user id
  'æ ¡å›­å’–å•¡å…',
  'æä¾›å„ç§ç¾å‘³å’–å•¡å’Œå°åƒ',
  true
)
ON CONFLICT DO NOTHING;
```

#### 4.3 æ’å…¥æµ‹è¯•åˆ†ç±»å’Œå•†å“

```sql
-- è·å–åˆšåˆ›å»ºçš„å•†å®¶ ID
-- å‡è®¾å•†å®¶ ID ä¸º '660e8400-e29b-41d4-a716-446655440001'

-- æ’å…¥åˆ†ç±»
INSERT INTO categories (merchant_id, name, display_order) 
VALUES 
  ('660e8400-e29b-41d4-a716-446655440001', 'çƒ­é¥®', 1),
  ('660e8400-e29b-41d4-a716-446655440001', 'å†·é¥®', 2),
  ('660e8400-e29b-41d4-a716-446655440001', 'å°åƒ', 3);

-- æ’å…¥å•†å“ï¼ˆéœ€è¦å…ˆæœ‰åˆ†ç±»ï¼‰
INSERT INTO products (merchant_id, category_id, name, description, price, is_available) 
SELECT 
  '660e8400-e29b-41d4-a716-446655440001',
  c.id,
  'ç¾å¼å’–å•¡',
  'ç»å…¸ç¾å¼å’–å•¡ï¼Œå£æ„Ÿæµ“éƒ',
  18.00,
  true
FROM categories c 
WHERE c.merchant_id = '660e8400-e29b-41d4-a716-446655440001' 
  AND c.name = 'çƒ­é¥®'
LIMIT 1;
```

---

## ğŸ§ª æµ‹è¯•æ¸…å•

å®Œæˆé…ç½®åï¼ŒæŒ‰ä»¥ä¸‹æ¸…å•æµ‹è¯•ï¼š

### åŸºç¡€åŠŸèƒ½æµ‹è¯•

- [ ] **åº”ç”¨å¯åŠ¨**
  - åº”ç”¨èƒ½æ­£å¸¸å¯åŠ¨
  - æ— å´©æºƒæˆ–é”™è¯¯

- [ ] **Supabase è¿æ¥**
  - æ§åˆ¶å°æ˜¾ç¤º "Supabase åˆå§‹åŒ–å®Œæˆ"
  - æ— è¿æ¥é”™è¯¯

- [ ] **æ•°æ®åº“æŸ¥è¯¢**ï¼ˆå¦‚æœå·²å®ç°ï¼‰
  - èƒ½æŸ¥è¯¢å•†å®¶åˆ—è¡¨
  - èƒ½æŸ¥è¯¢å•†å“åˆ—è¡¨

- [ ] **è®¤è¯åŠŸèƒ½**ï¼ˆå¦‚æœå·²å®ç°ï¼‰
  - èƒ½æ³¨å†Œæ–°ç”¨æˆ·
  - èƒ½ç™»å½•
  - èƒ½ç™»å‡º

- [ ] **å­˜å‚¨åŠŸèƒ½**ï¼ˆå¦‚æœå·²å®ç°ï¼‰
  - èƒ½ä¸Šä¼ å›¾ç‰‡
  - èƒ½è·å–å›¾ç‰‡ URL
  - èƒ½æ˜¾ç¤ºå›¾ç‰‡

---

## ğŸ” å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1ï¼šåº”ç”¨æ— æ³•è¿æ¥åˆ° Supabase

**æ£€æŸ¥é¡¹ï¼š**
1. æ£€æŸ¥ `supabase_config.dart` ä¸­çš„ URL å’Œ key
2. ç¡®è®¤ Supabase é¡¹ç›®çŠ¶æ€æ­£å¸¸
3. æ£€æŸ¥ç½‘ç»œè¿æ¥
4. æŸ¥çœ‹æ§åˆ¶å°é”™è¯¯ä¿¡æ¯

**è§£å†³æ–¹æ¡ˆï¼š**
```dart
// åœ¨ app_bootstrap.dart ä¸­ï¼Œdebug: true ä¼šè¾“å‡ºè¯¦ç»†æ—¥å¿—
// æŸ¥çœ‹æ—¥å¿—ä¸­çš„å…·ä½“é”™è¯¯ä¿¡æ¯
```

### é—®é¢˜ 2ï¼šRLS ç­–ç•¥å¯¼è‡´æ— æ³•è®¿é—®æ•°æ®

**æ£€æŸ¥é¡¹ï¼š**
1. ç¡®è®¤ç”¨æˆ·å·²ç™»å½•ï¼ˆå¦‚æœç­–ç•¥è¦æ±‚ authenticatedï¼‰
2. æ£€æŸ¥ RLS ç­–ç•¥æ˜¯å¦æ­£ç¡®
3. éªŒè¯ç”¨æˆ· ID æ˜¯å¦åŒ¹é…

**ä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼ˆä»…å¼€å‘é˜¶æ®µï¼‰ï¼š**
```sql
-- ä¸´æ—¶ç¦ç”¨æŸä¸ªè¡¨çš„ RLSï¼ˆä»…ç”¨äºæµ‹è¯•ï¼‰
ALTER TABLE products DISABLE ROW LEVEL SECURITY;
```

### é—®é¢˜ 3ï¼šå›¾ç‰‡ä¸Šä¼ å¤±è´¥

**æ£€æŸ¥é¡¹ï¼š**
1. ç¡®è®¤å­˜å‚¨æ¡¶ `product-images` å·²åˆ›å»º
2. æ£€æŸ¥å­˜å‚¨ç­–ç•¥æ˜¯å¦æ­£ç¡®
3. éªŒè¯æ–‡ä»¶å¤§å°ï¼ˆä¸è¶…è¿‡ 50MBï¼‰
4. ç¡®è®¤æ–‡ä»¶ç±»å‹ï¼ˆä»…æ”¯æŒå›¾ç‰‡æ ¼å¼ï¼‰

### é—®é¢˜ 4ï¼šè®¤è¯å¤±è´¥

**æ£€æŸ¥é¡¹ï¼š**
1. ç¡®è®¤ Email provider å·²å¯ç”¨
2. æ£€æŸ¥é‚®ç®±éªŒè¯è®¾ç½®ï¼ˆå¼€å‘æ—¶å¯å…³é—­ï¼‰
3. ç¡®è®¤å¯†ç ç¬¦åˆè¦æ±‚ï¼ˆæœ€å°‘ 6 ä½ï¼‰
4. æŸ¥çœ‹ Supabase Dashboard â†’ Authentication â†’ Logs

---

## ğŸ“ é…ç½®æ–‡ä»¶è¯´æ˜

### supabase_config.dart

```dart
class SupabaseConfig {
  static const String url = 'https://fpxdfnevjeyzxuzhfumb.supabase.co';
  static const String anonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...';
  static const String productImagesBucket = 'product-images';
  static const bool enableRealtimeSubscription = true;
}
```

**æ³¨æ„**ï¼šæ­¤æ–‡ä»¶åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œå·²åœ¨ `.gitignore` ä¸­ï¼Œä¸ä¼šæäº¤åˆ° Gitã€‚

### environment_config.dart

ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œé€šè¿‡ç¯å¢ƒå˜é‡é…ç½®ï¼š

```bash
flutter run --dart-define=SUPABASE_URL=https://xxx.supabase.co \
  --dart-define=SUPABASE_ANON_KEY=your-key
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥

é…ç½®å®Œæˆåï¼Œæ‚¨å¯ä»¥ï¼š

1. **å¼€å§‹å¼€å‘åŠŸèƒ½**
   - å®ç°ç™»å½•/æ³¨å†Œç•Œé¢
   - å®ç°å•†å“åˆ—è¡¨å±•ç¤º
   - å®ç°è´­ç‰©è½¦åŠŸèƒ½
   - å®ç°è®¢å•ç®¡ç†

2. **æµ‹è¯•æ ¸å¿ƒåŠŸèƒ½**
   - ç”¨æˆ·è®¤è¯æµç¨‹
   - æ•°æ® CRUD æ“ä½œ
   - å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½

3. **ä¼˜åŒ–å’Œéƒ¨ç½²**
   - æ€§èƒ½ä¼˜åŒ–
   - å®‰å…¨åŠ å›º
   - ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

---

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. **æŸ¥çœ‹æ–‡æ¡£**
   - `README.md` - é¡¹ç›®æ¦‚è¿°
   - `QUICK_START.md` - å¿«é€Ÿå¼€å§‹
   - `API_EXAMPLES.md` - API ä½¿ç”¨ç¤ºä¾‹

2. **æ£€æŸ¥æ—¥å¿—**
   - Flutter æ§åˆ¶å°æ—¥å¿—
   - Supabase Dashboard â†’ Logs

3. **å‚è€ƒèµ„æº**
   - [Supabase å®˜æ–¹æ–‡æ¡£](https://supabase.com/docs)
   - [Flutter å®˜æ–¹æ–‡æ¡£](https://flutter.dev/docs)

---

**å‡†å¤‡å®Œæˆï¼** ğŸ‰

ç°åœ¨æ‚¨å¯ä»¥å¼€å§‹å¼€å‘æ‚¨çš„æ ¡å›­ç‚¹é¤ç³»ç»Ÿäº†ï¼

